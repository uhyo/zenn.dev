---
title: "éæ¿€æ´¾ãŒæ•™ãˆã‚‹ï¼ã€€useEffectã®æ­£ã—ã„ä½¿ã„æ–¹"
emoji: "ğŸ‘¹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react"]
published: true
---

Reactã®**useEffect**ã¯ã€ãƒ•ãƒƒã‚¯ã®ä¸­ã§ã‚‚ä½¿ã„æ–¹ãŒé›£ã—ã„ã‚‚ã®ã®ä¸€ã¤ã§ã™ã€‚ãã“ã§ã€ã“ã®è¨˜äº‹ã§ã¯ç­†è€…ãŒè€ƒãˆã‚‹useEffectã®æœ›ã¾ã—ã„ä½¿ã„æ–¹ã‚’çš†ã•ã‚“ã«ä¼æˆã—ã¾ã™ã€‚

## åŸºæœ¬åŸå‰‡

æŠ€è¡“ã‚„ãã®è¦ç´ ã®ä½¿ã„æ–¹ã‚’è€ƒãˆã‚‹ã«ã‚ãŸã£ã¦ã€ç­†è€…ãŒå¥½ã‚“ã§ã„ã‚‹ã®ã¯åŸºæœ¬åŸå‰‡ã‚’ç½®ã„ã¦ãã‚Œã«åŸºã¥ã„ã¦åˆ¤æ–­ã™ã‚‹ã“ã¨ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã§ã€ã“ã®è¨˜äº‹ã§ã¯ã¾ãšç­†è€…ãŒè€ƒãˆã‚‹Reactã®åŸºæœ¬åŸå‰‡ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ç­†è€…ãŒã‚‚ã£ã¨ã‚‚é‡è¦è¦–ã™ã‚‹åŸå‰‡ã¯ã€**Reactã¯UIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã¤ã¾ã‚Šã€Reactã«ã¯UIã®ç®¡ç†ã‚’ã•ã›ã‚‹ã¹ãã§ã‚ã£ã¦ã€ãã®ä»–ã®ã“ã¨ã¯Reactã®å½¹ç›®ã§ã¯ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚ReactãŒé›£ã—ã„ã¨æ€ã†äººãŒã„ã‚‹å ´åˆã€ä½•ã§ã‚‚ã‹ã‚“ã§ã‚‚Reactã«ã‚„ã‚‰ã›ã‚ˆã†ã¨ã™ã‚‹ã‹ã‚‰ä½™è¨ˆã«é›£ã—ããªã£ã¦ã„ã‚‹ã®ã ã¨æ€ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã®ç®¡ç†ã‚„ãã‚Œã«ä»˜éšã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆã®ç®¡ç†ã¯Reactã®å½¹ç›®ã§ã¯ãªã„ã®ã§ã€Reactã®å¤–éƒ¨ã§å‡¦ç†ã™ã‚‹ã¹ãã§ã™ã€‚ãã®ãŸã‚ã«ã¯[Recoil](https://recoiljs.org/)ãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæœ‰ç”¨ã§ã™ã€‚

å½“ç„¶ãªãŒã‚‰useEffectã«ã¤ã„ã¦ã‚‚ã“ã®åŸå‰‡ãŒå½“ã¦ã¯ã¾ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€**useEffectã¯UIã®ç®¡ç†ã¨ã„ã†ç›®çš„ã®ãŸã‚ã«ä½¿ã†ã®ã§ã‚ã£ã¦ã€ãã‚Œä»¥å¤–ã®ä½¿ã„æ–¹ã¯è‰¯ããªã„**ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®åŸºæœ¬åŸå‰‡ã¯ã€**Reactã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚Reactã§ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é€šã˜ã¦UIã‚’ç®¡ç†ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«æ›¸ã‹ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€**useEffectã‚‚å«ã‚ã¦ã™ã¹ã¦ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“**ã€‚è¨€ã„æ–¹ã‚’å¤‰ãˆã‚Œã°ã€ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é–‰ã˜ãªã„ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã®ã¯è‰¯ããªãã¦ã€useEffectã‚‚ãã®ä¾‹å¤–ã§ã¯ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚

Reactã«ãŠã„ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚Šã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚Šã—ã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç”»é¢ã‹ã‚‰æ¶ˆãˆã‚‹ã®ã§ã™ã‹ã‚‰ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒUIã«ä¸ãˆãŸã‚ã‚‰ã‚†ã‚‹å½±éŸ¿ã¯æ¶ˆãˆã‚‹ã¹ãã§ã™ã€‚ã“ã®ã“ã¨ã‹ã‚‰ã€useEffectã‚’ä½¿ã†éš›ã®åŸå‰‡ã®ä¸€ã¤ã¨ã—ã¦ã€**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã®ç„¡ã„useEffectã¯ä¸é©æ ¼**ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ãŒè¨€ãˆã¾ã™ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ãŒç„¡ã„useEffectã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã«ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½±éŸ¿ãŒå…ƒã«æˆ»ã•ã‚Œãªã„ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®åŸå‰‡ã‹ã‚‰æ˜ã‚‰ã‹ã«å¤–ã‚Œã¦ã„ã¾ã™ã€‚

## ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£

ä»¥ä¸Šã§ã€ä¼ãˆã‚‹ã¹ãåŸå‰‡ã¯ä¼ãˆçµ‚ã‚ã‚Šã¾ã—ãŸã€‚ä»¥ä¸‹ã§ã¯ã€ã•ã¾ã–ã¾ãªå…·ä½“ä¾‹ã‚’é€šã˜ã¦ã€useEffectã®è‰¯ã„ä½¿ã„æ–¹ãƒ»è‰¯ããªã„ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ç™»éŒ²ã™ã‚‹ç³»

**è¨±å®¹åº¦:** ğŸ˜ƒ æ–‡å¥ãªã—ã€‚æœ›ã¾ã—ã„useEffectã®ä½¿ã„æ–¹

ä¾‹ãˆã°ã€æ¬¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ãƒã‚¦ã‚¹ã‚„ã‚¿ãƒƒãƒã§ãƒšãƒ¼ã‚¸å†…ã‚’ç§»å‹•ã™ã‚‹ã¨è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹è¦ç´ ã§ã¯ãªãã€ãƒšãƒ¼ã‚¸å…¨ä½“ã«å¯¾ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```tsx
const Component = () => {
  const [h, setH] = useState(0);

  useEffect(() => {
    const handler = () => {
      setH(h => (h + 1) % 360);
    };
    window.addEventListener("pointermove", handler);
    return () => {
      window.removeEventListener("pointermove", handler);
    };
  }, []);

  return (
    <div
      style={{
        backgroundColor: `hsl(${h}, 100%, 50%)`,
        width: "100px",
        height: "100px"
      }}
    />
  );
};
```

ã“ã®ã‚ˆã†ã«ã€Reactã®ä»–ã®æ©Ÿèƒ½ã§ã¯è³„ãˆãªã„ã‚ˆã†ãªDOMæ“ä½œã‚’ã—ãŸã„å ´åˆã«ã¯useEffectãŒå¿…è¦ã§ã™ã€‚Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã‚ãã¾ã§UIï¼ˆreact-domã§ã‚ã‚Œã°DOMï¼‰ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã‹ã‚‰ã€useEffectã‚’å¿…è¦ãªDOMæ“ä½œã®ãŸã‚ã«ä½¿ã†ã®ã¯æœ›ã¾ã—ã„ä½¿ã„æ–¹ã§ã™ã€‚

ä»–ã«ã‚‚ã€1ç§’é–“ã«60å›ãªã©ã€é«˜é »åº¦ã§ç™ºç”Ÿã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹å ´åˆã«ã‚‚useEffectã‚’ä½¿ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚Reactã®ä»•çµ„ã¿ã«ä¹—ã£ã¦å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸Šã®å•é¡ŒãŒã‚ã‚‹ã¨ã„ã†å ´åˆã«ã¯ã€ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒãƒƒãƒã¨ã—ã¦useEffectã‚’é€šã˜ã¦DOMæ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ç³»

**è¨±å®¹åº¦:** ğŸ™ƒ å ´åˆã«ã‚ˆã‚Šè¨±å®¹ã§ãã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã€‚ã—ã‹ã—ã€ã‚ˆã‚Šè‰¯ã„ä»£æ›¿æ‰‹æ®µãŒãã®ã†ã¡ç™»å ´ã™ã‚‹ã®ã§å°†æ¥æ€§ã¯ä¹ã—ã„

ä¾‹ãˆã°ã€æ¬¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€GitHubã®APIã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã—ã€è¡¨ç¤ºã—ã¾ã™ã€‚

```tsx
const Component = () => {
  const [user, setUser] = useState<null | { login: string }>(null);

  useEffect(() => {
    const abortController = new AbortController();
    fetch("https://api.github.com/users/uhyo", {
      signal: abortController.signal
    })
      .then(res => res.json())
      .then(user => setUser(user))
      .catch(reportError);

    return () => {
      abortController.abort();
    };
  }, []);

  return <div>{user?.login}</div>;
};
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã¨`fetch`ã«ã‚ˆã‚ŠAPIã‚’å‘¼ã³å‡ºã—ã€çµæœãŒå¾—ã‚‰ã‚ŒãŸã‚‰ãã®å†…å®¹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã®å®Ÿè£…ã§ã¯useEffectã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã«APIã®å‘¼ã³å‡ºã—ãŒã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã‚‰å¤–éƒ¨ã«ä¸ãˆãŸå…¨ã¦ã®å½±éŸ¿ãŒæ¶ˆãˆã‚‹ã¹ãã§ã‚ã‚‹ã¨ã„ã†åŸå‰‡ãŒå®ˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å¿˜ã‚Œã¦ã„ãŸã‚‰0ç‚¹ã§ã™ã€‚

ãŸã ã—ã€ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’useEffectã§è¡Œã†ã®ãŒã„ã¤ã§ã‚‚è¨±å®¹ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€**Reactã¯UIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹**ã¨ã„ã†åŸå‰‡ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚UIã«é–¢é€£ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¯useEffectã®åˆ©ç”¨æ–¹æ³•ã¨ã—ã¦æœ›ã¾ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã“ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®UIä»¥å¤–ã®éƒ¨åˆ†ï¼ˆã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ãªã©ï¼‰ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å ´åˆã«ã¯ã€useEffectã‚’ä½¿ã†ã®ã¯é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãã®å ´åˆã¯Recoilãªã©ã€Reactã®å¤–éƒ¨ã«ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ç§»ã™ã¹ãã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿å–å¾—ã«useEffectã‚’ä½¿ã£ã¦ã„ã„ã®ã¯ã€ã‚ãã¾ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ç”¨é€”ãŒãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«é™ã‚‰ã‚Œã‚‹ã¨ãã ã‘ã§ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«æ›¸ã‹ã‚Œã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚Šã€useEffectã‚‚ãã®ä¾‹å¤–ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãŸã¾ã«ã€ã€ŒuseEffectã¯**å‰¯ä½œç”¨**ã‚’æ‹…å½“ã™ã‚‹ãƒ•ãƒƒã‚¯ã§ã‚ã‚Š[^note_side_effect]ã€Reactã®æœ¬æ¥ã®ã‚„ã‚Šæ–¹ã‹ã‚‰å¤–ã‚ŒãŸãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ããŸã‚ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒãƒƒãƒã§ã‚ã‚‹ã€ã¨ã„ã†ä¸»å¼µã‚’è¦‹ã‹ã‘ã¾ã™ãŒã€ç­†è€…ã¯ã“ã‚Œã«ã¯è³›åŒã—ã¾ã›ã‚“ã€‚useEffectã‚‚ã‚Œã£ãã¨ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã§ã‚ã‚Šã€Reactçš„ãªä½¿ã„æ–¹ã§ä½¿ã†ã¹ãã‚‚ã®ã§ã™ã€‚Reactã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ©Ÿèƒ½ï¼ˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é€šã˜ãŸDOMæ“ä½œï¼‰ã§è¡¨ç¾ã§ããªã„ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«useEffectãŒã‚ã‚‹ã®ã§ã€ã‚ã‚‹ç¨®ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒãƒƒãƒã§ã¯ã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€çš†ã•ã‚“ãŒæƒ³åƒã™ã‚‹ã‚ˆã†ãªâ€œå‰¯ä½œç”¨â€ã¯ã€ãŸã¨ãˆuseEffectã‚’ä½¿ã£ãŸã¨ã—ã¦ã‚‚ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã‚ãã¾ã§â€œä¸»ä½œç”¨â€ã®ãŸã‚ã«useEffectã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

[^note_side_effect]: ä»¥å‰ã€Œå‰¯ä½œç”¨ã€ã¨ã„ã†è¨€è‘‰ã‚’ä½¿ã£ãŸã‚‰ã€Œé–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ã¯å‰¯ä½œç”¨ã¨ä¸»ä½œç”¨ã®ã‚ˆã†ãªåŒºåˆ¥ã¯ãªãã€å˜ã«ä½œç”¨ãŒã‚ã‚‹ã ã‘ã§ã‚ã‚‹ã€ã¨ã„ã†ã‚ˆã†ãªæŒ‡æ‘˜ã‚’ã‚‚ã‚‰ã£ãŸã®ã§ã™ãŒã€ç­†è€…ã¯æœ€è¿‘Reactã¯Reactã¨ã„ã†ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã§ã‚ã‚Šã€é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«ç„¡ç†ã«å½“ã¦ã¯ã‚ã‚‹ã“ã¨ã«ã¯ã‚ã¾ã‚Šæ„å‘³ãŒãªã„ã¨æ€ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã®ã§ã€ä»Šå›ã¯Reactç”¨èªã¨ã—ã¦å‰¯ä½œç”¨ã¨ã„ã†è¨€è‘‰ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚useEffectãŒEffectã¨åä¹—ã£ã¦ã„ã‚‹ã‹ã‚‰ã«ã¯Reactç”¨èªã¨ã—ã¦ã€Œä½œç”¨ã€ã§ã‚ã‚‹ã“ã¨ã¯ç–‘ã„ã‚ˆã†ãŒãªãã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ãŒï¼ˆä¸»ï¼‰ä½œç”¨ã€ãã†ã§ã¯ãªãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¤–ãªã©ã«å½±éŸ¿ã‚’åŠã¼ã—ã¦ã—ã¾ã†ã‚‚ã®ã‚’å‰¯ä½œç”¨ã¨åˆ†é¡ã—ã¦ã„ã¾ã™ã€‚

ä½™è«‡ã§ã™ãŒã€ãã‚‚ãã‚‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å ´åˆã¯ã€å°†æ¥çš„ã«ã¯`use`ãŒæ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•ã«ãªã‚Šãã†ã§ã™ã€‚ãã®ãŸã‚ã€ã“ã®ç”¨é€”ã§useEffectã‚’ä½¿ã†ã“ã¨ã¯ç„¡ããªã‚‹ã§ã—ã‚‡ã†ã€‚

### ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã®ä¾‹

**è¨±å®¹åº¦:** ğŸ˜¡ ã ã‚

useEffectã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```tsx
const Component = () => {
  const [searchQuery, setSearchQuery] = useState("");

  useEffect(() => {
    track("search", { searchQuery });
  }, [searchQuery]);

  return (
    <input
      value={searchQuery}
      onChange={e => setSearchQuery(e.target.value)}
    />
  );
};
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹ãŸã‚ã«useEffectã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€`searchQuery`ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

ã“ã®ä¾‹ã¯ã€useEffectã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ä¾‹ã¨ã—ã¦ã¯å…¸å‹çš„ãªã‚‚ã®ã§ã™ã€‚useEffectã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ã®ã¯**Reactã¯UIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹**ã¨ã„ã†åŸå‰‡ã«åã—ã¦ã„ã¾ã™ã€‚ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã¯UIã«é–¢é€£ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã§ã‚ã‚Šã€useEffectã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ã®ã¯é©åˆ‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ç‰¹ã«ç›®ã«ä»˜ãå•é¡Œã¨ã—ã¦ã¯ã€useEffectã®è¿”ã‚Šå€¤ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ä¾‹ã§ã¯ã€ä¸€åº¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ãŸã‚‰ãã‚Œã‚’å–ã‚Šæ¶ˆã™æ‰‹æ®µãŒç„¡ã„ãŸã‚ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã§ããªã„ã®ã§ã™ã€‚ã“ã®ã‚ˆã†ã«ã€useEffectã‹ã‚‰æ›´æ–°ç³»ã®å‡¦ç†ã‚’ã™ã‚‹ã“ã¨ã¯å•ç­”ç„¡ç”¨ã§ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

ã¾ãŸã€ä¸Šã®ä¾‹ã§ã¯useEffectã®ä¾å­˜é…åˆ—ãŒãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‚‚æ°—ã«å…¥ã‚Šã¾ã›ã‚“ã€‚ç­†è€…ã®è€ƒãˆã§ã¯ã€useEffectã®ä¾å­˜é…åˆ—ã¨ã„ã†ã®ã¯ã€useMemoã®ä¾å­˜é…åˆ—ã¨åŒã˜ãã€æœ€é©åŒ–ã®ãŸã‚ã«ä½¿ã†ã¹ãã§ã™ã€‚useEffectã«ä¾å­˜é…åˆ—ã‚’æ¸¡ã•ãªã„å ´åˆã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãŸã³ã«å®Ÿè¡Œã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒè¡Œã‚ã‚Œã‚‹æŒ™å‹•ã¨ãªã‚Šã€ã“ã‚ŒãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨è€ƒãˆã‚‹ã¹ãã§ã™ã€‚ãã“ã¾ã§é »ç¹ã«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®é©ç”¨ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’è¡Œã†å¿…è¦ãŒãªã„å ´åˆã«ã€æœ€é©åŒ–ã¨ã—ã¦ä¾å­˜é…åˆ—ã‚’æ¸¡ã™ã®ã§ã™ã€‚

ã¤ã¾ã‚Šæ¥µè«–ã€useEffectã«æ¸¡ã•ã‚ŒãŸä¾å­˜é…åˆ—ãŒæœ€é©åŒ–ã‚’è¶…ãˆãŸæ„å‘³ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã¯ã€ãã®useEffectã¯ä¸é©æ ¼ã§ã™ã€‚ä¸Šã®ä¾‹ã§ã¯useEffectã®æ„å‘³ã ã‘è¦‹ã‚Œã°ã€`searchQuery`ãŒå¤‰åŒ–ã™ã‚‹ã‚ˆã‚Šã‚‚ã£ã¨é »ç¹ã«`track`ãŒå®Ÿè¡Œã•ã‚Œã¦ã‚‚ãŠã‹ã—ããªã„ã‚ˆã†ã«èª­ã‚ã¾ã™ã€‚ä»Šã¯ãŸã¾ãŸã¾Reactã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒã¡ã‚‡ã†ã©æˆ‘ã€…ãŒæ„å›³ã—ãŸé »åº¦ã§å®Ÿè¡Œã—ã¦ãã‚Œã¦ã„ã‚‹ã ã‘ãªã®ã§ã™ã€‚

ã•ã‚‰ã«ã€Reactã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹lintãƒ«ãƒ¼ãƒ«ã§ã¯useEffectç­‰ã®ä¾å­˜é…åˆ—ãŒæ­£ã—ããªã„å ´åˆï¼ˆå†…éƒ¨ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å€¤ãŒä¾å­˜é…åˆ—ã«ãªã„å ´åˆãªã©ï¼‰ã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ç„¡è¦–ã™ã‚‹ã®ã‚‚å½“ç„¶ã”æ³•åº¦ã§ã™ã€‚æ™®é€šã«ãƒã‚°ã®ã‚‚ã¨ã§ã™ã—ã€ä¾å­˜é…åˆ—ã‚’ä¸Šè¿°ã®ã‚ˆã†ã«æ‰ãˆã¦ã„ã‚Œã°ã€ä¾å­˜é…åˆ—ã®ãƒ«ãƒ¼ãƒ«ã‚’é€¸è„±ã™ã‚‹å¿…è¦ã¯çš†ç„¡ã§ã™ã€‚

å®Ÿéš›ã€[ä»¥å‰ã®è¨˜äº‹ã§è§£èª¬ã—ãŸã‚ˆã†ã«](https://zenn.dev/uhyo/articles/react-18-alpha-essentials#strictmode-%E3%81%A7%E3%81%AE-useeffect-%E3%81%AE%E6%8C%99%E5%8B%95%E3%81%AE%E5%A4%89%E5%8C%96)ã€React 18ã‹ã‚‰ã¯StrictModeä½¿ç”¨æ™‚ã«useEffectã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒè¤‡æ•°å›å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®æŒ™å‹•ãŒé©ç”¨ã•ã‚ŒãŸå ´åˆã¯ä¸Šã®useEffectã‹ã‚‰ã‚‚æ„å›³ã—ãªã„å›æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã¤ã¾ã‚Šã€éæ¿€æ´¾ãªã®ã§è¨€ã„åˆ‡ã‚Šã¾ã™ãŒã€**å€¤ã®å¤‰åŒ–ã«åå¿œã™ã‚‹ãŸã‚ã«useEffectã‚’ä½¿ã†ã®ã¯è‰¯ããªã„**ã®ã§ã™ã€‚

ä¸Šã®ä¾‹ã§ã¯ã€useEffectã‚’ä½¿ã‚ãšã«æ¬¡ã®ã‚ˆã†ã«å®Ÿè£…ã—ãŸã»ã†ãŒã€ã‚³ãƒ¼ãƒ‰ã®æ„å›³ã‚’ã‚ˆã‚Šçš„ç¢ºã«è¡¨ã—ã¦ã„ã‚‹ã®ã§ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

```tsx
const Component = () => {
  const [searchQuery, setSearchQuery] = useState("");

  const handleChange = 
    (e: React.ChangeEvent<HTMLInputElement>) => {
      setSearchQuery(e.target.value);
      track("search", { searchQuery: e.target.value });
    };

  return <input value={searchQuery} onChange={handleChange} />;
};
```

### ãƒšãƒ¼ã‚¸ãŒå¤‰ã‚ã£ãŸã‚‰ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹ã‚„ã¤

**è¨±å®¹åº¦:** ğŸ˜ˆ ã‚ã‹ã‚“ã§

ä¸Šã®ä¾‹ã®äºœç¨®ã¨ã—ã¦ã€ãƒšãƒ¼ã‚¸ãŒå¤‰ã‚ã£ãŸã‚‰ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹ã¨ã„ã†ã‚ã‚ŠãŒã¡ãªä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```tsx
const Component = () => {
  const router = useRouter();

  useEffect(() => {
    track("pageview", { page: router.pathname });
  }, [router.pathname]);

  return <div>...</div>;
};
```

SPAã§ã¯ã€ãƒšãƒ¼ã‚¸ã®é·ç§»ã‚’ãƒ«ãƒ¼ã‚¿ãƒ¼ã¨å‘¼ã°ã‚Œã‚‹æ©Ÿæ§‹ãŒæ‹…ã£ã¦ã„ã¾ã™ã€‚ä¸Šã®ä¾‹ã®useRouterã¯ãƒ«ãƒ¼ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰æä¾›ã•ã‚Œã‚‹ãƒ•ãƒƒã‚¯ã¨ã„ã†æƒ³å®šã§ã™ã€‚

ã“ã®ä¾‹ã‚‚ã€å‰ã®ç¯€ã§è¿°ã¹ãŸé€šã‚Šã®å•é¡Œã‚’æŒã£ã¦ã„ã¾ã™ã€‚å½“ç„¶ã€useEffectã®ã‚ˆã„ä½¿ã„æ–¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

å…ˆã»ã©ã¨åŒã˜ã‚ˆã†ã«ãƒšãƒ¼ã‚¸é·ç§»ã‚’ç™ºç”Ÿã•ã›ã‚‹å´ã®ã‚³ãƒ¼ãƒ‰ã§ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚‚æ¸ˆã¾ã›ã‚‹ã®ãŒä¸€ã¤ã®æ‰‹ã§ã™ãŒã€ãã®æ–¹æ³•ã ã¨åŒã˜ã‚³ãƒ¼ãƒ‰ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã«åˆ†æ•£ã—ã¦ã—ã¾ã†ã®ã«åŠ ãˆã¦ãŸã ã€é«˜ç´šãªãƒ«ãƒ¼ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã¨ãƒšãƒ¼ã‚¸é·ç§»ã«å‰²ã‚Šè¾¼ã‚€æ©Ÿèƒ½ãªã©ã‚‚ã‚ã‚Šã€ãƒšãƒ¼ã‚¸é·ç§»å´ã§å‡¦ç†ã™ã‚‹ã®ã¯ãã‚‚ãã‚‚é›£ã—ãã†ã§ã™ã€‚æœ›ã‚€ã‚‰ãã¯ã€Reactå¤–ã®ã¨ã“ã‚ã§ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œçŸ¥ã§ãã‚‹æ©Ÿæ§‹ãŒãƒ«ãƒ¼ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ã¹ãã§ã™ã€‚ãƒ«ãƒ¼ã‚¿ãƒ¼ã«`onRouteChange`ã¿ãŸã„ãªã®ãŒç”Ÿãˆã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ãã®ã‚ˆã†ãªAPIã§ã‚ã‚Œã°ã€ãƒšãƒ¼ã‚¸é·ç§»ã¨ãƒ­ã‚¸ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã§ç´ã¥ã„ãŸå½¢ã§ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¤ã¾ã‚Šã€ãŸã¨ãˆã°React Routerã§ã‚ã‚Œã°`history.listen`ã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’è¡Œã†ã®ãŒæ­£ã—ã„æ–¹æ³•ã¨ãªã‚Šã¾ã™ã€‚Next.jsã§ã‚ã‚Œã°`router.events`ã‚’çµŒç”±ã—ã¦å¿…è¦ãªã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã¯Next.jsã®ä¾‹ã§ã™ã€‚

```tsx:æ­£ã—ã„æ–¹æ³•ï¼ˆNext.jsã®ä¾‹ï¼‰
const RouteTracker = () => {
  const router = useRouter();

  useEffect(() => {
    const handler = (url: string) => {
      track("pageview", { page: url });
    };
    router.events.on("routeChangeComplete", handler);

    return () => {
      router.events.off("routeChangeComplete", handler);
    };
    }
  }, [router]);

  return null;
};
```

ã“ã®ä¾‹ã§ã¯ã¾ã useEffectã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ã€ŒuseEffectã‚’ä½¿ã£ã¦`router.pathname`ã®å¤‰åŒ–ã«åå¿œã™ã‚‹ã€ã¨ã„ã†å•é¡Œã®ã‚ã‚‹ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚’è„±å´ã—ã€routerã«å¯¾ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹ã¨ã„ã†æ„å‘³ã®ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã¡ã‚“ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨ãªã£ã¦ãŠã‚Šã€å…ƒã€…ã®ä¾‹ã®å•é¡ŒãŒè§£æ¶ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ãŸã ã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å¸¸ã«nullã‚’è¿”ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰UIã«å¯„ä¸ã—ã¦ã„ã‚‹ã¨ã¯è¨€ã„é›£ãã€100ç‚¹æº€ç‚¹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚Next.jsãŒãƒ•ãƒƒã‚¯ã‚’ä»‹ã—ã¦ã—ã‹ãƒ«ãƒ¼ã‚¿ãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¦ãã‚Œãªã„ãŸã‚è‹¦è‚‰ã®ç­–ã¨ã—ã¦ã“ã†ãªã£ã¦ã„ã‚‹ã¨ã„ã†ä¾‹ã§ã™ã€‚

### useRefã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè¡Œå›æ•°ã‚’åˆ¶å¾¡ã™ã‚‹ã‚„ã¤

**è¨±å®¹åº¦:** ğŸ¥¶ å»¶å‘½æªç½®ã§ã—ã‹ãªã„

React 18ã®StrictModeã§useEffectã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒè¤‡æ•°å›å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã„ã†æŒ™å‹•ã«å¯¾ã—ã¦ã€useRefã‚’ä½¿ã£ã¦å›æ•°ã‚’åˆ¶é™ã™ã‚‹ã¨ã„ã†ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```tsx
const NicePage = () => {
  const eventFiredRef = useRef(false);
  useEffect(() => {
    // React 18ã®StrictModeã§2å›ç™ºç«ã™ã‚‹ã®ã§å¯¾ç­–
    if (!eventFiredRef.current) {
      track("view", { page: "NicePage" });
      eventFiredRef.current = true;
    }
  }, []);

  return <div>...</div>;
};
```

ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã€useEffectã‚’ç”¨ã„ã¦ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€React 18ã®StrictModeã§ã¯useEffectã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒ2å›å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å¯¾ç­–ã¨ã—ã¦useRefã‚’ä½¿ã£ã¦1å›ã ã‘å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã†ã™ã‚‹ã¨ç¢ºã‹ã«React 18ã®StrictModeä¸‹ã§ã‚‚1å›ã ã‘ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ãŒã€ãŠå¯Ÿã—ã®é€šã‚Šã€æ ¹æœ¬çš„ãªè§£æ±ºç­–ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®å ´åˆã®å•é¡Œã¯ã€æœ¬æ¥Reactã®å¤–ã§å–ã‚Šæ‰±ã†ã¹ãå•é¡Œã‚’ã‚ã–ã‚ã–useEffectã‚’ä½¿ã£ã¦Reactã‚’ä»‹ã—ã¦å–ã‚Šæ‰±ã£ã¦ã„ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚ç„¡é§„ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŒŸã¾ã‚‹ã“ã¨ã§ã€ã“ã®ã‚ˆã†ã«ç„¡é§„ãªãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã‚‚å¿…è¦ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã™ã€‚

React 18ãŒç™»å ´ã—ãŸéš›ã«StrictModeã§useEffecté–¢é€£ã®å¯¾å¿œã«è¿½ã‚ã‚Œã¦ã€Reactã¯ä½•ã§ã“ã‚“ãªã«ã‚„ã‚„ã“ã—ã„ã‚“ã ã¨æ€ã£ãŸæ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€å¤§æŠµã®å ´åˆã¯useEffectã‚’ä½¿ã£ãŸæ™‚ç‚¹ã§é–“é•ã£ãŸã‚„ã‚Šæ–¹ã§ã‚ã‚Šã€é“ãŒæ•´å‚™ã•ã‚Œã¦ã„ãªã„ã¨ã“ã‚ã‚’é€²ã‚“ã§æ­©ãã«ãã„ã¨æ–‡å¥ã‚’è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

### useRef+useEffectã®ä¾‹ã¨ã—ã¦ã‚ˆãå‡ºã¦ãã‚‹ã‚¿ã‚¤ãƒãƒ¼ã®ã‚„ã¤

ãŸã¨ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªè¦ä»¶ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚

- 1ç§’ã”ã¨ã«ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’åœæ­¢ã™ã‚‹ã€‚

#### æ„šç›´ãªå®Ÿè£…

ã“ã®è¦ä»¶ã‚’æ„šç›´ã«å®Ÿè£…ã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
const Timer = () => {
  const [count, setCount] = useState(0);
  const [paused, setPaused] = useState(false);

  useEffect(() => {
    if (paused) {
      return;
    }
    const timerId = setInterval(() => {
      setCount((c) => c + 1);
    }, 1000);
    return () => {
      clearInterval(timerId);
    };
  }, [paused]);

  return (
    <div>
      <div>{count}</div>
      <label>
        <input
          type="checkbox"
          checked={paused}
          onChange={(e) => setPaused(e.currentTarget.checked)}
        />
        pause
      </label>
    </div>
  );
};
```

**è¨±å®¹åº¦:** ğŸ¥° useEffectã®ä½¿ã„æ–¹ã¨ã—ã¦ã¯å®Œç’§

#### useIntervalã«ã‚ˆã‚‹å®Ÿè£…

ãŸã ã€ä¸Šã®å®Ÿè£…ã ã¨æŒ™å‹•ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸæ™‚ç‚¹ã§1ç§’ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã€1ç§’æœªæº€ã®é–“éš”ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’é€£æ‰“ã™ã‚‹ã¨ã‚«ã‚¦ãƒ³ãƒˆãŒå…¨ãé€²ã¾ãªã„ã®ã§ã™ã€‚

è¦ä»¶ã®å®šç¾©æ¬¡ç¬¬ã§ã™ãŒã€1ç§’ã”ã¨ã«åˆ¤å®šãŒã‚ã‚Šã€ãã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã„ã†è¦ä»¶ã ã¨ã—ã¾ã—ã‚‡ã†ã€‚ã“ã®å ´åˆã€[Dan Abramovæ°ã«ã‚ˆã‚‹ã‚ˆãçŸ¥ã‚‰ã‚ŒãŸuseIntervalã¨ã„ã†ãƒ•ãƒƒã‚¯](https://usehooks-ts.com/react-hook/use-interval)ã‚’ä½¿ãˆã°æ¬¡ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx
const Timer = () => {
  const [count, setCount] = useState(0);
  const [paused, setPaused] = useState(false);

  useInterval(() => {
    if (paused) {
      return;
    }
    setCount((c) => c + 1);
  }, 1000);

  return (
    /* ... */
  );
};
```

ã“ã®ãƒ•ãƒƒã‚¯ã§ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹é–“å¸¸ã«ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ãç¶šã‘ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‹ã‚‰ã¯å¸¸ã«æœ€æ–°ã®stateï¼ˆ`paused`ï¼‰ãŒå‚ç…§ã§ãã‚‹ã¨ã„ã†ã®ãŒç‰¹å¾´ã§ã™ã€‚ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€å¸¸ã«æœ€æ–°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’useRefã§ä½œã£ãŸrefã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å…¥ã‚Œã€useEffectå†…ã§setIntervalã§ä½œã‚‰ã‚ŒãŸã‚¿ã‚¤ãƒãƒ¼ã‹ã‚‰ã¯refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å…¥ã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚useRefã‚’ä½¿ã‚ãªã„ã¨ã€useEffectã§ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½œã£ãŸæ™‚ç‚¹ã®stateã—ã‹å‚ç…§ã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```tsx:useIntervalã®å®Ÿè£…ï¼ˆä¸Šè¨˜ã®è¨˜äº‹ã‹ã‚‰å¼•ç”¨ï¼‰
function useInterval(callback: () => void, delay: number | null) {
  const savedCallback = useRef(callback)

  // Remember the latest callback if it changes.
  useIsomorphicLayoutEffect(() => {
    savedCallback.current = callback
  }, [callback])

  // Set up the interval.
  useEffect(() => {
    // Don't schedule if no delay is specified.
    // Note: 0 is a valid value for delay.
    if (!delay && delay !== 0) {
      return
    }

    const id = setInterval(() => savedCallback.current(), delay)

    return () => clearInterval(id)
  }, [delay])
}
```

ã“ã®ã‚ˆã†ã«ã€useEffectå†…å¤–ã‚„è¤‡æ•°ã®useEffecté–“ã§å€¤ã‚’å—ã‘æ¸¡ã™å¿…è¦ãŒã‚ã‚‹å ´åˆã«useRefã‚’äº¤ãˆãŸãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚è¨€ã†ãªã‚Œã°ã€useRefã¨ã„ã†ã®ã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆã‚„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãªã©ï¼‰ç”¨ã®å¤‰æ•°ç½®ãå ´ã¨è¨€ãˆã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªå®Ÿè£…ã«å¯¾ã™ã‚‹ç­†è€…ã®è©•ä¾¡ã¯ã¨ã„ã†ã¨ã€

**è¨±å®¹åº¦:** ğŸ¤¯ ã¡ã‚ƒã‚“ã¨éš è”½ã—ã¦ã„ã‚‹ãªã‚‰â€¦â€¦

ã“ã®æ–¹æ³•ã¯easyã•ã‚’å„ªå…ˆã—ã¦ã‹ãªã‚Šhackyãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ç†Ÿé”è€…ä»¥å¤–ãŒçœŸä¼¼ã™ã‚‹ã“ã¨ã¯ãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚ãã‚‚ãã‚‚ã€useEffecté–“ã§å€¤ã‚’å—ã‘æ¸¡ã™ã¨ã„ã†äº‹æ…‹ãŒå°‹å¸¸ã§ã¯ãªãã€åŸå‰‡ã®ç¯„å›²å†…ã®ã‚„ã‚Šæ–¹ã§ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚ä¸€å¿œã€useIntervalã¨ã„ã†ãƒ•ãƒƒã‚¯ã«hackyãªéƒ¨åˆ†ã‚’ã†ã¾ãéš è”½ã§ãã¦ã„ã‚‹ã®ã§ãã“ã‚’è©•ä¾¡ã—ã¦ã€çµ¶å¯¾ã«ã‚„ã‚‹ãªã¨ã„ã†ç¨‹ã§ã¯ãªã„å°è±¡ã§ã™ã€‚

#### useEffectã®åŸå‰‡ã‚’å®ˆã£ãŸå®Ÿè£…

ä½•ã¨ã‹ç­†è€…ã®åŸå‰‡ã‚’å®ˆã£ã¦å®Ÿè£…ã™ã‚‹ã¨ã€ãŸã¨ãˆã°ã“ã‚“ãªæ„Ÿã˜ã®å®Ÿè£…ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

```tsx
const Timer = () => {
  const [initialTime] = useState(Date.now());
  const [count, setCount] = useState(0);
  const [paused, setPaused] = useState(false);

  useEffect(() => {
    if (paused) {
      return;
    }
    const now = Date.now();
    let nextTime = now + 1000 - ((now - initialTime) % 1000);
    const loop = () => {
      setCount((c) => c + 1);
      const now = Date.now();
      nextTime = now + 1000 - ((nextTime - now) % 1000);
      const diff = nextTime - now;

      timerId = setTimeout(loop, diff);
    };
    const diff = nextTime - now;
    let timerId = setTimeout(loop, diff);
    return () => {
      clearTimeout(timerId);
    };
  }, [paused, initialTime]);

  return (
    /* ... */
  );
};
```

**è¨±å®¹åº¦:** ğŸ˜ æº€è¶³æ„Ÿã¯ã‚ã‚‹

ã“ã®å®Ÿè£…ã¯ã€æœ€åˆã«èµ·ç‚¹ã¨ãªã‚‹æ™‚åˆ»ã‚’ã‚¹ãƒ†ãƒ¼ãƒˆã«è¨˜æ†¶ã—ã¦ãŠãã“ã¨ã§ã€useEffectã‹ã‚‰setTimeoutã‚’ä»˜ã‘ãŸã‚Šæ¶ˆã—ãŸã‚Šã—ã¦ã‚‚å¸¸ã«1ç§’å‘¨æœŸã§ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ãã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ï¼ˆã‚¿ã‚¤ãƒãƒ¼ã®å¤§é›‘æŠŠã•ã¯ã•ã¦ãŠã„ã¦ï¼‰ã€‚ã‚„ã‚„ã“ã—ã„å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã¯å¦å®šã—ã¾ã›ã‚“ãŒã€ä¸€ã¤ã®useEffectã«å‡¦ç†ãŒé–‰ã˜ã¦ã„ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚‚ã¡ã‚ƒã‚“ã¨ã•ã‚Œã‚‹ã¨ã„ã†ã€æ­£ã—ã•ã®é¢ã§ã¯æ–‡å¥ã®ãªã„å®Ÿè£…ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã‚„ã‚„ã“ã—ã„ã¨ã¯è¨€ã£ã¦ã‚‚ã€ã‚¿ã‚¤ãƒãƒ¼ã®å‡¦ç†ã¨ã„ã†ã®ã¯å…ƒã€…ã‚„ã‚„ã“ã—ã„ã‚‚ã®ã§ã™ã€‚å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯å˜ç´”ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’å‹•ã‹ã™ã ã‘ã§ã¯ä¸è¶³ã§ã€ã‚¿ãƒ–ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«è¡Œã£ãŸå ´åˆã©ã†ã„ã†å‡¦ç†ã«ã™ã‚‹ã®ã‹ãªã©è€ƒãˆã‚‹ã“ã¨ãŒå¤šãã‚ã‚Šã¾ã™ï¼ˆå®Ÿã¯ä¸Šã®å®Ÿè£…ã‚‚ãã®å ´åˆã«å°‘ã—é…æ…®ã—ã¦ã„ã¾ã™ï¼‰ã€‚ã‚¿ã‚¤ãƒãƒ¼ã‚’æ‰±ã†ã«ã¯ã“ã®ãã‚‰ã„ã®ã‚„ã‚„ã“ã—ã•ã¯è¦šæ‚Ÿã—ãªã„ã¨ã„ã‘ãªã„ã§ã—ã‚‡ã†ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ã“ã®ä¾‹ã§ã¯ã€ä¸€è¦‹useRefãªã©ã‚’ä½¿ã‚ãªã„ã¨ã§ããªãã†ãªå®Ÿè£…ã‚‚ã€å·¥å¤«æ¬¡ç¬¬ã§åŸå‰‡ã‚’å®ˆã£ãŸã¾ã¾å®Ÿè£…ã§ãã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã—ãŸã€‚

:::details ä½™è«‡

å®Ÿã¯ã€ç´°ã‹ãªæŒ™å‹•ã«å·®ç•°ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ä»Šå›ã®è¦ä»¶ã§ã‚ã‚Œã°é›£ã—ã„ã“ã¨ã‚’è€ƒãˆãšã«æ¬¡ã®ã‚ˆã†ã«ã™ã‚Œã°ä¸‡äº‹è§£æ±ºã§ã—ãŸã€‚

```tsx
const Timer2 = () => {
  const [{ count, paused }, setState] = useState({
    count: 0,
    paused: false
  });

  useEffect(() => {
    const timerId = setInterval(() => {
      setState((prev) =>
        prev.paused
          ? prev
          : {
              ...prev,
              count: prev.count + 1
            }
      );
    }, 1000);
    return () => {
      clearInterval(timerId);
    };
  }, []);

  return (
    <div>
      <div>{count}</div>
      <label>
        <input
          type="checkbox"
          checked={paused}
          onChange={(e) =>
            setState((prev) => ({
              ...prev,
              paused: !paused
            }))
          }
        />
        pause
      </label>
    </div>
  );
};
```

**è¨±å®¹åº¦:** ğŸ’¯ ã“ã‚Œã¾ã§ã®èŒ¶ç•ªã¯ä½•ã ã£ãŸã®ã‹

:::

## ã¾ã¨ã‚

ã“ã®è¨˜äº‹ã§ã¯ã€ã„ãã¤ã‹ã®useEffectã®ä½¿ç”¨ä¾‹ã«ã¤ã„ã¦ã€Reactã®åŸå‰‡ã«åŸºã¥ã„ã¦è©•ä¾¡ã—ã¾ã—ãŸã€‚

çµå±€ã€å€‹ã€…ã®ä¾‹ã®è©•ä¾¡ã«ã¤ã„ã¦ã¯Reactå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®[useEffect](https://react.dev/reference/react/useEffect)ã‚„[You Might Not Need an Effect](https://react.dev/learn/you-might-not-need-an-effect)ã¨ã„ã£ãŸãƒšãƒ¼ã‚¸ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ã¨å¤§å·®ãªã„ã‚‚ã®ã«ãªã‚Šã¾ã—ãŸã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã™ã”ã„ã§ã™ã­ã€‚ä»Šå›ã®è¨˜äº‹ã§ã¯ã€ãã‚Œã‚‰ã«å¯¾ã—ã¦å°‘ãªã„åŸå‰‡ã‹ã‚‰èª¬æ˜ã‚’ä¸ãˆãŸã¨ã“ã‚ã‚’è©•ä¾¡ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

ãŸã ã€ã“ã®è¨˜äº‹ã§ã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã®ãªã„useEffectã‚’å…¨å¦å®šã—ã¦ã„ã¾ã™ãŒã€å¤šåˆ†Reactå…¬å¼ã¯ãã“ã¾ã§å³ã—ã„è€ƒãˆæ–¹ã§ã¯ãªã•ãã†ã§ã™ã€‚ã“ã®è¾ºã‚ŠãŒéæ¿€æ´¾è¦ç´ ã§ã™ã€‚

æ–‡ä¸­ã«å‡ºã¦ããŸåŸå‰‡ã‚„ãã®å¸°çµã‚’ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

**åŸºæœ¬åŸå‰‡:**

- Reactã¯UIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã€‚
- Reactã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã€‚

**å¸°çµ:**

- useEffectã¯UIã®ç®¡ç†ã¨ã„ã†ç›®çš„ã®ãŸã‚ã«ä½¿ã†ã€‚
- useEffectã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã§ã‚ã‚‹ã€‚
  - useEffectã¯â€œå‰¯ä½œç”¨â€ã®ãŸã‚ã®ã‚‚ã®ã§ã¯ãªã„ã€‚
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã®ç„¡ã„useEffectã¯ä¸é©æ ¼ã€‚
- useEffectã®ä¾å­˜é…åˆ—ã¯æœ€é©åŒ–ã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚Šã€æœ€é©åŒ–ã‚’è¶…ãˆãŸæ„å‘³ã‚’æŒã£ãŸä¾å­˜é…åˆ—ã¯ä¸é©æ ¼ã§ã‚ã‚‹ã€‚
  - å€¤ã®å¤‰åŒ–ã«åå¿œã™ã‚‹ãŸã‚ã«useEffectã‚’ä½¿ã†ã®ã¯è‰¯ããªã„ã€‚
  - ä¾å­˜é…åˆ—ã®lintã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã™ã‚‹ã®ã¯ã”æ³•åº¦ã€‚

  å¸°çµãŒå¤šã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€æœ¬æ–‡ã‚’èª­ã‚“ã§ã„ãŸã ãã¨åˆ†ã‹ã‚‹é€šã‚Šã€å°‘ãªã„åŸå‰‡ã‹ã‚‰å°ãå‡ºã•ã‚Œã‚‹ã®ã§åˆ¥ã«ã‚„ã‚„ã“ã—ã„ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

  ã‚€ã—ã‚ã€useEffectã‚’ä½¿ã†ã¹ãã§ã¯ãªã„å ´é¢ã§useEffectã‚’ä½¿ã†ã»ã†ãŒã€ã‚ãªãŸã®Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚ˆã»ã©è¤‡é›‘ã§ç†è§£ã—ãŒãŸã„ã‚‚ã®ã«ã™ã‚‹ã¯ãšã§ã™ã€‚

  ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§æ¥½ã—ã„useEffectãƒ©ã‚¤ãƒ•ã‚’é€ã‚Šã¾ã—ã‚‡ã†ã€‚
