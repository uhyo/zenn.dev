---
title: "おわりに"
---

本書では、ReactのSuspenseをjotaiと組み合わせて活用する方法を解説してきました。この章では、本書で学んだことを振り返り、今後のReact開発に役立つポイントをまとめます。

## 本書で学んだこと

本書を通じて、以下のことを学びました。

### Suspenseの本質

Suspenseは、非同期処理を**宣言的UI**に組み込むための仕組みです。従来の`useEffect`でデータを取得してステートに保存する方法と異なり、Suspenseでは非同期処理自体がUIの計算の一部として扱われます。

重要なのは、サスペンドするコンポーネントが**自身のステート内にPromiseを保持できない**ことでした。これが、jotaiのような外部ステート管理ライブラリを活用する動機となります。

### jotaiの活用

jotaiは、Suspenseを前提としたステート管理ライブラリです。特に以下の点が重要でした。

- **派生atom**を使うことで、非同期処理のPromiseをキャッシュできる
- **atomFamily**を使うことで、パラメータごとにatomを動的に生成できる
- **派生atomの書き込み**を使うことで、再読み込みなどの操作をカプセル化できる

### UIバージョニングの考え方

派生atomの再読み込みは、「再読み込みキー」を更新することで実現しました。これは一見場当たり的な解決策に見えるかもしれませんが、実は**UIバージョニング**という考え方に基づいています。

再読み込みキーをUIのバージョンとして捉えることで、「パラメータが変わったから結果が変わった」と解釈でき、データ取得が純粋な計算であるという前提を保てます。これはReactの思想と整合する考え方です。

### トランジションの重要性

トランジションは、Suspenseを実用的に活用するために欠かせない機能です。

- フォールバックUIの**ちらつきを防止**できる
- `isPending`を使って、**読み込み中であることをユーザーにフィードバック**できる
- 複数のトランジションを使い分けることで、**UIのどの部分が読み込み中か**を正確に伝えられる

また、トランジション中にReactが「古い世界」と「新しい世界」の2つのUIを同時にレンダリングしていることも学びました。

### 無駄なサスペンドの削減

jotai-eagerを使うことで、**本当に非同期処理が必要な場合のみPromiseを返す**atomを作成できます。これにより、キャッシュが効いている場合には同期的に値を返し、無駄なサスペンドを避けられます。

### エラーハンドリング

Suspenseの世界では、Error Boundaryが非同期処理のエラーハンドリングにも使われます。Error Boundaryの配置を適切に設計することで、エラー発生時にUIのどの部分がフォールバックに置き換わるかをコントロールできます。

## Suspense時代のReact開発

本書を通じて、Suspense以後のReact開発では考え方が大きく変わったということを感じていただけたのではないでしょうか。

従来のReactでは、自分で行うにしろ外部ライブラリに任せるにしろ、`isLoading`のような読み込み中の状態の対応をコンポーネント内で明示的に扱う必要がありました。しかし、Suspenseの世界では、この責務がReactに移譲され、より宣言的なUI構築が可能になります。

それに合わせて、Promiseの取り扱いが大きく変わったのも印象的でした。従来は非同期処理を行う際にちょっと出てくる概念でしたが、Suspense以後はPromiseをpropsで渡したりステートに入れたりなど、より積極的にPromiseを扱うようになります。

この変化により、コンポーネントのロジックはシンプルになります。ただし、その代わりにSuspense境界やError Boundary境界、トランジションの設計といった**アーキテクチャ的な考慮**が必要になります。

これらは、従来のアプリケーションでも何かしらの方法で対処していた（もしくは対処しきれていなかった）課題です。決してまったく新しい問題が増えたのではなく、対処の仕方が変わったということです。

## さいごに

Suspenseは、Reactの非同期処理に対する考え方を大きく変えた機能です。最初は戸惑うこともあるかもしれませんが、本書で学んだ基礎を活かして、ぜひ実際のプロジェクトでSuspenseを活用してみてください。

本書が、皆さんのReact開発の一助となれば幸いです。

なお、今後も追加で書きたい内容が出てきた場合はこの本を随時更新していく予定です。フィードバックや要望があれば、ぜひお知らせください。

## 更新履歴

- 2026-01-03: 初版公開
